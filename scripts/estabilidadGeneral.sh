#!/bin/bash

GREEN='\033[0;32m'
NC='\033[0m'

DEFAULT_IP="192.168.1.105"
DEFAULT_PATH_INSTRUCCIONES="/home/utnso/Desktop/revenge-of-the-cth-pruebas/"
DEFAULT_PATH_SWAP="/home/utnso/swapfile.bin"
DEFAULT_PATH_DUMP="/home/utnso/dump_files/"

read -p "Ingrese la IP de Memoria [${DEFAULT_IP}]: " IP_MEMORIA
IP_MEMORIA=${IP_MEMORIA:-$DEFAULT_IP}

read -p "Ingrese la IP del Kernel [${DEFAULT_IP}]: " IP_KERNEL
IP_KERNEL=${IP_KERNEL:-$DEFAULT_IP}

read -p "Ingrese el path a las instrucciones [${DEFAULT_PATH_INSTRUCCIONES}]: " PATH_INSTRUCCIONES
PATH_INSTRUCCIONES=${PATH_INSTRUCCIONES:-$DEFAULT_PATH_INSTRUCCIONES}

read -p "Ingrese el path del swapfile [${DEFAULT_PATH_SWAP}]: " PATH_SWAP
PATH_SWAP=${PATH_SWAP:-$DEFAULT_PATH_SWAP}

read -p "Ingrese el path para dumps [${DEFAULT_PATH_DUMP}]: " PATH_DUMP
PATH_DUMP=${PATH_DUMP:-$DEFAULT_PATH_DUMP}

CPU_DIR="./cpu"
KERNEL_CONFIG="./kernel/kernel.config"
MEMORIA_CONFIG="./memoria/memoria.config"
IO_CONFIG="./io/io.config"

CONFIG1="IP_MEMORIA=$IP_MEMORIA
PUERTO_MEMORIA=8002
IP_KERNEL=$IP_KERNEL
PUERTO_KERNEL_DISPATCH=8001
PUERTO_KERNEL_INTERRUPT=8004
ENTRADAS_TLB=4
REEMPLAZO_TLB=FIFO
ENTRADAS_CACHE=2
REEMPLAZO_CACHE=CLOCK
RETARDO_CACHE=50
LOG_LEVEL=INFO"

CONFIG2="IP_MEMORIA=$IP_MEMORIA
PUERTO_MEMORIA=8002
IP_KERNEL=$IP_KERNEL
PUERTO_KERNEL_DISPATCH=8001
PUERTO_KERNEL_INTERRUPT=8004
ENTRADAS_TLB=4
REEMPLAZO_TLB=LRU
ENTRADAS_CACHE=2
REEMPLAZO_CACHE=CLOCK-M
RETARDO_CACHE=50
LOG_LEVEL=INFO"

CONFIG3="IP_MEMORIA=$IP_MEMORIA
PUERTO_MEMORIA=8002
IP_KERNEL=$IP_KERNEL
PUERTO_KERNEL_DISPATCH=8001
PUERTO_KERNEL_INTERRUPT=8004
ENTRADAS_TLB=256
REEMPLAZO_TLB=FIFO
ENTRADAS_CACHE=256
REEMPLAZO_CACHE=CLOCK
RETARDO_CACHE=1
LOG_LEVEL=INFO"

CONFIG4="IP_MEMORIA=$IP_MEMORIA
PUERTO_MEMORIA=8002
IP_KERNEL=$IP_KERNEL
PUERTO_KERNEL_DISPATCH=8001
PUERTO_KERNEL_INTERRUPT=8004
ENTRADAS_TLB=0
REEMPLAZO_TLB=FIFO
ENTRADAS_CACHE=0
REEMPLAZO_CACHE=CLOCK
RETARDO_CACHE=0
LOG_LEVEL=INFO"

KERNEL_CFG="IP_MEMORIA=$IP_MEMORIA
PUERTO_MEMORIA=8002
PUERTO_ESCUCHA_DISPATCH=8001
PUERTO_ESCUCHA_INTERRUPT=8004
PUERTO_ESCUCHA_IO=8003
ALGORITMO_CORTO_PLAZO=SRT
ALGORITMO_INGRESO_A_READY=PMCP
ALFA=0.75
ESTIMACION_INICIAL=100
TIEMPO_SUSPENSION=3000
LOG_LEVEL=INFO"

MEMORIA_CFG="PUERTO_ESCUCHA=8002
TAM_MEMORIA=4096
TAM_PAGINA=32
ENTRADAS_POR_TABLA=8
CANTIDAD_NIVELES=3
RETARDO_MEMORIA=100
PATH_SWAPFILE=$PATH_SWAP
RETARDO_SWAP=2500
LOG_LEVEL=INFO
DUMP_PATH=$PATH_DUMP
PATH_INSTRUCCIONES=$PATH_INSTRUCCIONES"

IO_CFG="IP_KERNEL=$IP_KERNEL
PUERTO_KERNEL=8003
LOG_LEVEL=INFO"

echo "$CONFIG1" > "$CPU_DIR/cpu1.config"
echo "$CONFIG2" > "$CPU_DIR/cpu2.config"
echo "$CONFIG3" > "$CPU_DIR/cpu3.config"
echo "$CONFIG4" > "$CPU_DIR/cpu4.config"
echo "$KERNEL_CFG" > "$KERNEL_CONFIG"
echo "$MEMORIA_CFG" > "$MEMORIA_CONFIG"
echo "$IO_CFG" > "$IO_CONFIG"

echo -e "${GREEN}Archivos de configuraci√≥n generados correctamente:${NC}"
echo "Ejecute kernel con ESTABILIDAD_GENERAL 0 para realizar la prueba"
echo "Recordar que se debe ejecutar primero memoria y luego 4 instancias de DISCO y CPU"
